<!DOCTYPE html><html>
<head>
<meta charset="utf-8">
<title>cs1.6 amxx编程 new精研教程 -- 作者:偶萤蛉(Oinling)</title>
<style>
	code {
		white-space: pre;
		color: rgb(0,0,255);
		background-color: #f1f1f1;
		font-family: Consolas, monospace;
		font-weight: bold;
	}
	.amxx-note {
		color: rgb(0,0,0);
		font-weight: normal;
	}
	.amxx-comment {
		color: rgb(63,159,63);
		font-weight: normal;
	}
	.amxx-directive {
		color: rgb(111,111,107);
		font-weight: normal;
	}
	.amxx-di {
		background: linear-gradient(to right, rgb(111,111,107), rgb(153,51,255));
		-webkit-background-clip: text;
		color: transparent;
		font-weight: normal;
	}
	.amxx-string {
		color: rgb(193,61,41);
		font-weight: normal;
	}
	.amxx-number {
		color: rgb(0,0,0);
		font-weight: normal;
	}
	.amxx-enumname {
		background: linear-gradient(to right, rgb(93,20,10), rgb(153,51,255));
		-webkit-background-clip: text;
		color: transparent;
	}
	.amxx-function {
		color: rgb(113,31,195);
		font-weight: bold;
	}
	.amxx-tag {
		color: rgb(93,20,10);
		font-weight: normal;
	}
	.amxx-symbol {
		color: rgb(153,51,255);
		font-weight: normal;
	}
</style>
</head>
<body>

<p><h1>cs1.6 amxx编程 new精研教程 -- 作者:偶萤蛉(Oinling)</h1></p>

<p><h1>目录:</h1></p>

<p><a href="#click1">1:new的语法格式</a></p>
<p><a href="#click2">2:new声明详解</a></p>
<p><a href="#click2.1">2.1:new</a></p>
<p><a href="#click2.2">2.2:说明符2</a></p>
<p><a href="#click2.3">2.3:说明符3</a></p>
<p><a href="#click2.4">2.4:说明符4</a></p>
<p><a href="#click2.5">2.5:标签</a></p>
<p><a href="#click2.6">2.6:符号名称</a></p>
<p><a href="#click2.7">2.7:维度列表</a></p>
<p><a href="#click2.8">2.8:初始化表达式</a></p>
<p><a href="#click3">3:实例-new的基本使用方法</a></p>
<p><a href="#click3.1">3.1:声明变量</a></p>
<p><a href="#click3.2">3.2:与其它说明符一起使用</a></p>
<p><a href="#click3.2.1">3.2.1:new const常量</a></p>
<p><a href="#click3.2.2">3.2.2:new stock备用变量</a></p>
<p><a href="#click3.2.3">3.2.3:new static静态变量</a></p>
<p><a href="#click3.2.4">3.2.4:new public公共变量</a></p>
<p><a href="#click3.2.5">3.2.5:new static stock const静态备用常量,new public stock const公共备用常量</a></p>
<p><a href="#click3.3">3.3:总结</a></p>

<p><h1 id="click1">1:new的语法格式</h1></p>

<p><code>new 说明符2 说明符3 说明符4 <span class="amxx-tag">标签</span> <span class="amxx-symbol">符号名称</span> <span class="amxx-number">维度列表</span> 初始化表达式;</code></p>

<p>参考:</p>

<p><code>new static stock const <span class="amxx-tag">bool:</span> <span class="amxx-symbol">customSymbol</span> [<span class="amxx-number">2</span>][<span class="amxx-number">2</span>][<span class="amxx-number">2</span>][<span class="amxx-number">2</span>] =<span class="amxx-symbol">true</span>;</code></p>

<p><code>new</code>说明符用于声明自定义符号(变量).</p>

<p>在函数体外,<code>new</code>可以与<code>public static stock const</code>说明符同时存在.</p>

<p>在函数体内,<code>new</code>可以与<code>const</code>说明符同时存在.</p>

<p><code>new</code>是1号位的说明符,不论在函数体内还是体外,都必须写在左边第1位.</p>

<p><code>new</code>说明符有以下特性:</p>

<p><h2>1:被声明的自定义符号(变量)不能是函数.</h2></p>

<p><h2>2:被声明的自定义符号(变量)拥有地址.可通过地址进行查改.</h2></p>

<p><h2>3:在函数体内,可将"运行时表达式"用作自定义符号(变量)的"初始化表达式".</h2></p>

<p>相对其它说明符,<code>new</code>的第3个特性是独一无二的.</p>

<p>作为1号位的说明符,<code>new</code>的特性拥有最高优先级.</p>

<p>使用多个说明符时,若某些特性有冲突,以高优先级的为主.</p>

<p><h1 id="click2">2:new声明详解</h1></p>

<p><h2 id="click2.1">2.1:new</h2></p>

<p><code>new</code>说明符可以写在函数体内或体外.用于声明自定义符号(变量).</p>

<p>在函数体外声明的符号被称为"全局变量".可在下方任意函数体内被调用.</p>

<p>在函数体内声明的符号被称为"局部变量".仅能在当前代码块,与其内层代码块中被调用.</p>

<p><h2 id="click2.2">2.2:说明符2</h2></p>

<p>说明符2是可省略的.</p>

<p>在函数体外,说明符2可以是<code>public static</code>之一.在函数体内则不允许.</p>

<p>若填写<code>public</code>,则自定义符号可以被其他插件访问.</p>

<p>AMXX1.8.3以下版本中,拥有<code>public</code>说明符的自定义符号不能是数组.</p>

<p>若填写<code>static</code>,则自定义符号仅能在当前文件中被访问.当前插件的其它文件不能访问它.</p>

<p><h2 id="click2.3">2.3:说明符3</h2></p>

<p>说明符3是可省略的.</p>

<p>说明符3只能写<code>stock</code>,这是唯一的3号位说明符.</p>

<p>若填写<code>stock</code>,编译器不会警告符号(变量)未被调用.</p>

<p>若符号(变量)未被调用,则编译时,不会将符号(变量)写入amxx文件,不会占用内存空间.</p>

<p><h2 id="click2.4">2.4:说明符4</h2></p>

<p>说明符4是可省略的.</p>

<p>说明符4可以写<code>const</code>.表示声明的自定义符号只能被初始化表达式设置默认值.接下来的代码中不能被任何运算符更改.</p>

<p><h2 id="click2.5">2.5:标签</h2></p>

<p>标签是可省略的.</p>

<p>声明每个自定义符号都可在左边填写标签.表示该符号的运算方式或用途.</p>

<p>若省略标签,则默认该符号使用 <span class="amxx-tag">_:</span> 标签.</p>

<p><h2 id="click2.6">2.6:符号名称</h2></p>

<p>符号名称是自定义的,命名时应遵守符号命名规则.</p>

<p>在AMXX1.8.3以下版本中,符号名称不得超过31个字符.</p>

<p>在AMXX1.8.2以上版本中,符号名称不得超过63个字符.</p>

<p>名称的第一个字符必须是"<span class="amxx-symbol">_ @ a</span>至<span class="amxx-symbol">z A</span>至<span class="amxx-symbol">Z</span>"这四者之一.</p>

<p>名称的剩余字符必须是"<span class="amxx-symbol">_ @ a</span>至<span class="amxx-symbol">z A</span>至<span class="amxx-symbol">Z 0</span>至<span class="amxx-symbol">9</span>"这五者之一.</p>

<p>通常根据用途,给符号设定相关的英文名.</p>

<p>不得与保留词或用户声明的其它符号重名.</p>

<p><h2 id="click2.7">2.7:维度列表</h2></p>

<p>维度列表是可省略的.</p>

<p>声明每个自定义符号都可在右边填写维度列表(方括号).表示该符号的数据结构.</p>

<p>若省略维度列表,则默认该符号仅能储存1个数值.</p>

<p>在AMXX1.10.0以下版本中,一个符号仅允许0至3对方括号,在AMXX1.9.0以上版本中,一个符号允许有0至4对方括号.</p>

<p>拥有维度列表的符号被称为数组.假设符号<span class="amxx-symbol">A</span>拥有4对方括号,那么<span class="amxx-symbol">A</span>是4维数组.</p>

<p>4维数组内存放的是3维数组,3维数组内存放的是2维数组,2维数组内存放的是1维数组,1维数组内存放的是数值.</p>

<p>数组内存放的对象被称作元素.而方括号内填写的数值则是表示数组的尺寸,或容量,或元素数量.</p>

<p>假设<span class="amxx-symbol">A</span>的维度列表是<code>[<span class="amxx-number">2</span>][<span class="amxx-number">3</span>][<span class="amxx-number">4</span>][<span class="amxx-number">5</span>]</code>,那么<span class="amxx-symbol">A</span>的元素数量是2,</p>

<p><span class="amxx-symbol">A</span>的每个元素都是3维数组,每个3维数组的元素数量都是3,</p>

<p>3维数组的每个元素都是2维数组,每个2维数组的元素数量都是4,</p>

<p>2维数组的每个元素都是1维数组,每个1维数组的元素数量都是5,</p>

<p>1维数组的每个元素都是数值,因此每个1维数组都拥有5个数值.</p>

<p>方括号中的数值必须是字面量或无地址的常量,像<code>new</code>声明的有地址符号是不允许填入维度列表的.</p>

<p>方括号中的数值是可省略的.省略时,编译器会根据初始化表达式决定具体数量(这种情况下不允许省略初始化表达式).</p>

<p><h2 id="click2.8">2.8:初始化表达式</h2></p>

<p>初始化表达式是可省略的.</p>

<p>声明每个自定义符号都可以在其维度列表右边(若没有就在符号名称右边)填写初始化表达式(以 <code>=</code> 符号开头的赋值表达式).</p>

<p>表示该符号的默认值.</p>

<p>若被声明的符号是数组,应赋值为字符串或数组字面量.否则应赋值为单个数值字面量.</p>

<p>若省略初始化表达式,则该符号的默认值为0.</p>

<p>初始化表达式可以用 <code>,</code> 符号结尾.表示接下来还要以相同的说明符继续声明自定义符号.</p>

<p>也可以用 <code>;</code> 符号结尾,表示停止继续声明自定义符号.</p>

<p>通常情况下是可以省略 <code>;</code> 符号的.但在检查分号模式下不允许省略 <code>;</code> 符号.</p>

<p><h1 id="click3">3:实例-new的基本使用方法</h1></p>

<p><h2 id="click3.1">3.1:声明变量</h2></p>

<code><span class="amxx-comment">// 最普通的声明方式(未填写初始化表达式,因此变量的值为0)</span>
new <span class="amxx-symbol">gVariable1</span>;

<span class="amxx-comment">// 连续声明多个变量,并初始化</span>
new <span class="amxx-symbol">gVariable2</span> = <span class="amxx-number">2</span>, <span class="amxx-symbol">gVariable3</span> = <span class="amxx-number">3</span>, <span class="amxx-symbol">gVariable4</span> = <span class="amxx-number">100</span>;

<span class="amxx-comment">// 声明带有标签的变量</span>
new <span class="amxx-tag">bool:</span><span class="amxx-symbol">gVariable5</span> = <span class="amxx-symbol">true</span>, <span class="amxx-tag">Float:</span><span class="amxx-symbol">gVariable6</span> = <span class="amxx-number">222.0</span>;

<span class="amxx-comment">// 声明拥有维度列表的变量,这是尺寸为4的1维数组,拥有4个值为0的元素</span>
new <span class="amxx-symbol">gVariable7</span>[<span class="amxx-number">4</span>];

<span class="amxx-comment">// 声明尺寸由初始化表达式决定的1维数组变量,拥有4个元素,因此尺寸为4</span>
new <span class="amxx-symbol">gVariable8</span>[] = { <span class="amxx-number">1</span>, <span class="amxx-number">2</span>, <span class="amxx-number">3</span>, <span class="amxx-number">4</span> };

<span class="amxx-comment">// 声明尺寸为5的3维数组变量,并设定其内2维数组的尺寸为2,1维数组的尺寸为3</span>
new <span class="amxx-tag">Float:</span><span class="amxx-symbol">gVariable9</span>[<span class="amxx-number">5</span>][<span class="amxx-number">2</span>][<span class="amxx-number">3</span>] =
{
	{
		{ <span class="amxx-number">1.0</span>, <span class="amxx-number">2.0</span>, <span class="amxx-number">3.0</span> },
		{ <span class="amxx-number">4.0</span>, <span class="amxx-number">5.0</span>, <span class="amxx-number">6.0</span> },
	},
	{
		{ <span class="amxx-number">7.0</span>, <span class="amxx-number">8.0</span>, <span class="amxx-number">9.0</span> },
		{ <span class="amxx-number">10.0</span>, <span class="amxx-number">11.0</span>, <span class="amxx-number">12.0</span> },
	},
	{
		{ <span class="amxx-number">13.0</span>, <span class="amxx-number">14.0</span>, <span class="amxx-number">15.0</span> },
		{ <span class="amxx-number">16.0</span>, <span class="amxx-number">17.0</span>, <span class="amxx-number">18.0</span> },
	},
	{
		{ <span class="amxx-number">19.0</span>, <span class="amxx-number">20.0</span>, <span class="amxx-number">21.0</span> },
		{ <span class="amxx-number">22.0</span>, <span class="amxx-number">23.0</span>, <span class="amxx-number">24.0</span> },
	},
	{
		{ <span class="amxx-number">25.0</span>, <span class="amxx-number">26.0</span>, <span class="amxx-number">27.0</span> },
		{ <span class="amxx-number">28.0</span>, <span class="amxx-number">29.0</span>, <span class="amxx-number">30.0</span> },
	}
};

<span class="amxx-comment">// 在函数体内,声明变量,并使用运行时表达式作为变量的初始化表达式</span>
<span class="amxx-directive">#include</span> <span class="amxx-string">amxmodx</span>
public <span class="amxx-function">plugin_init</span>()
{
	new <span class="amxx-symbol">variable1</span> = <span class="amxx-function">random</span>(<span class="amxx-number">5</span>);		<span class="amxx-comment">// 函数只能在游戏运行时才能运行,编译时无法确认具体的值</span>
	new <span class="amxx-tag">Float:</span><span class="amxx-symbol">variable2</span> = <span class="amxx-number">10.0</span> + <span class="amxx-number">20.0</span>;	<span class="amxx-comment">// 浮点数的大部分运算符都是函数</span>
}</code>

<p><h2 id="click3.2">3.2:与其它说明符一起使用</h2></p>

<p><h3 id="click3.2.1">3.2.1:new const常量</h3></p>

<p>同时使用<code>new const</code>,则声明的符号是有地址的常量.</p>

<p>去除<code>const</code>的特性:</p>

<p>"不能连续声明常量",</p>
<p>"声明的常量不能是数组",</p>
<p>"声明的常量必须初始化",</p>
<p>"声明的常量不能用作引用参数".</p>

<p>保留<code>const</code>的特性:</p>

<p>"声明的常量不能被运算符更改".</p>

<p><code><span class="amxx-comment">// 声明一个有地址的常量,不能被运算符更改.</span>
new const <span class="amxx-symbol">gConstant</span> = <span class="amxx-number">222</span>;</code></p>

<p><h3 id="click3.2.2">3.2.2:new stock备用变量</h3></p>

<p>同时使用<code>new stock</code>,则声明的符号是备用变量.</p>

<p>去除<code>stock</code>的特性:</p>

<p>未知.</p>

<p>保留<code>stock</code>的特性:</p>

<p>"说明符仅允许在函数体外使用",</p>
<p>"不警告符号未被使用,不将未被使用的符号编译到amxx文件".</p>

<p>目前看来,同时使用<code>new stock</code>与单独使用<code>stock</code>没什么不同.</p>

<p><code>new</code>说明符允许将运行时表达式用作变量的初始化表达式.</p>

<p>但在函数体外无法表现出这个特性.AMXX不支持在函数体外运行函数.</p>

<p>因此,目前看来,同时使用<code>new stock</code>并没有什么用处.</p>

<p><code><span class="amxx-comment">// 声明一个备用变量,接下来的代码中并未调用它,则不被写入amxx文件,因此不会触发警告:"gStock符号从未被使用"</span>
new stock <span class="amxx-symbol">gStock</span> = <span class="amxx-number">222</span>;</code></p>

<p><h3 id="click3.2.3">3.2.3:new static静态变量</h3></p>

<p>同时使用<code>new static</code>,则声明的符号是静态变量.</p>

<p>去除<code>static</code>的特性:</p>

<p>"可声明函数或变量".</p>

<p>保留<code>static</code>的特性:</p>

<p>"被声明的函数或全局变量,仅当前文件可访问.其它文件,插件,模块都无法访问",</p>
<p>"被声明的局部变量,不会被销毁.因此,下次进入代码块,依然能访问变量最后一次储存的值".</p>

<p>在函数体内,不允许符号同时拥有<code>new static</code>说明符.</p>

<p>在函数体外,目前看来,同时使用<code>new static</code>与单独使用<code>static</code>没什么不同.</p>

<p><code>new</code>说明符允许将运行时表达式用作变量的初始化表达式.</p>

<p>但在函数体外无法表现出这个特性.AMXX不支持在函数体外运行函数.</p>

<p>因此,目前看来,同时使用<code>new static</code>并没有什么用处.</p>

<p><code><span class="amxx-comment">// 声明一个静态变量,仅当前文件可以访问它</span>
new static <span class="amxx-symbol">gStatic</span> = <span class="amxx-number">222</span>;</code></p>

<p><h3 id="click3.2.4">3.2.4:new public公共变量</h3></p>

<p>同时使用<code>new public</code>,则声明的符号是公共变量.</p>

<p>去除<code>public</code>的特性:</p>

<p>"可声明函数或变量".</p>

<p>保留<code>public</code>的特性:</p>

<p>"仅允许在函数体外使用",</p>
<p>"被声明的变量不能是数组",</p>
<p>"被声明的函数或变量可被其它文件,插件,模块访问".</p>

<p>在AMXX1.8.2以上版本中,<code>public</code>不再拥有"被声明的变量不能是数组"这个特性.</p>

<p>在函数体外,目前看来,同时使用<code>new public</code>与单独使用<code>public</code>没什么不同.</p>

<p><code>new</code>说明符允许将运行时表达式用作变量的初始化表达式.</p>

<p>但在函数体外无法表现出这个特性.AMXX不支持在函数体外运行函数.</p>

<p>因此,目前看来,同时使用<code>new public</code>并没有什么用处.</p>

<p><code><span class="amxx-comment">// 声明一个公共变量,任何文件,插件,模块都能访问它.</span>
new public <span class="amxx-symbol">gPublic</span> = <span class="amxx-number">222</span>;</code></p>

<p><h3 id="click3.2.5">3.2.5:new static stock const静态备用常量,new public stock const公共备用常量</h3></p>

<p>同时使用<code>new public stock const</code>或<code>new static stock const</code>声明自定义符号.</p>

<p><code><span class="amxx-comment">// 静态备用常量(实在没什么应用场景.大型插件可能会用到)</span>
new static stock const <span class="amxx-symbol">gStaticStockConstant</span> = <span class="amxx-number">222</span>;

<span class="amxx-comment">// 公共备用常量(实在没什么应用场景.大型插件可能会用到)</span>
new public stock const <span class="amxx-symbol">gPublicStockConstant</span> = <span class="amxx-number">222</span>;</code></p>

<p><h2 id="click3.3">3.3:总结</h2></p>

<p><code>new</code>说明符最特殊的一点是:"在函数体内,可将运行时表达式用变量的作初始化表达式".</p>

<p>当<code>new</code>被用于函数体外,则失去这一特性(AMXX不支持函数体外的运行时表达式).</p>

<p>由于<code>new public static stock</code>声明的符号都拥有地址,目前看来,<code>new</code>与<code>public static stock</code>一起使用,不会增加任何好处.</p>

<p>但可以与<code>const</code>一起使用.声明有地址的常量,使该常量可以通过地址被更改.或是声明有维度列表的数组常量.</p>

<p>在AMXX1.8.2以上版本中,<code>amxconst.inc</code>文件内便声明了这种有地址常量.</p>

<p>虽然编译时该常量的值为0,但插件运行后,由模块更改它的值.</p>

<p>插件访问这个常量得到的是被更改后的值.</p>

<p><code><span class="amxx-comment">// 服务器最大客户端数量,由模块设定这个常量的值.</span>
public stock const <span class="amxx-symbol">MaxClients</span>;</code></p>

</body>
</html>
